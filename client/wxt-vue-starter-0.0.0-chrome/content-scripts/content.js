var content=function(){"use strict";var R=Object.defineProperty;var v=(E,o,u)=>o in E?R(E,o,{enumerable:!0,configurable:!0,writable:!0,value:u}):E[o]=u;var c=(E,o,u)=>v(E,typeof o!="symbol"?o+"":o,u);var C,f;function E(r){return r}const o=((f=(C=globalThis.browser)==null?void 0:C.runtime)==null?void 0:f.id)==null?globalThis.chrome:globalThis.browser;async function u(r,t){const n=o.runtime.getURL(r),e=document.createElement("script");o.runtime.getManifest().manifest_version===2?e.innerHTML=await fetch(n).then(s=>s.text()):e.src=n,(document.head??document.documentElement).append(e)}var a;(r=>{(t=>{t.INJECT_CONTENT="INJECT_CONTENT",t.BG_POPUP="BG_POPUP"})(r.Channel||(r.Channel={})),(t=>{t.INJECT_CONTENT="INJECT_CONTENT",t.CONTENT_BG="CONTENT_BG",t.BG_POPUP="BG_POPUP"})(r.Port||(r.Port={})),(t=>{t.REQUEST="REQUEST",t.APPROVE="APPROVE",t.EVENT="EVENT"})(r.MessageType||(r.MessageType={})),(t=>{t.INJECTED="INJECTED",t.CONTENT="CONTENT",t.BACKGROUND="BACKGROUND",t.POPUP="POPUP"})(r.MessageFrom||(r.MessageFrom={})),(t=>{t.INJECTED="INJECTED",t.CONTENT="CONTENT",t.BACKGROUND="BACKGROUND",t.POPUP="POPUP"})(r.MessageTo||(r.MessageTo={})),(t=>{t.GET_APPROVE_DATA="GET_APPROVE_DATA",t.GET_APPROVE_DATA_RESPONSE="GET_APPROVE_DATA_RESPONSE",t.APPROVE_RESPONSE="APPROVE_RESPONSE",t.REJECT_RESPONSE="REJECT_RESPONSE",t.REQUEST_ACCOUNTS="REQUEST_ACCOUNTS",t.GET_ACCOUNTS="GET_ACCOUNTS",t.GET_NETWORK="GET_NETWORK",t.SWITCH_NETWORK="SWITCH_NETWORK",t.GET_PUBLIC_KEY="GET_PUBLIC_KEY",t.GET_BALANCE="GET_BALANCE",t.SEND_BITCOIN="SEND_BITCOIN",t.SIGN_MESSAGE="SIGN_MESSAGE",t.SIGN_PSBT="SIGN_PSBT",t.SIGN_PSBTS="SIGN_PSBTS",t.PUSH_TX="PUSH_TX",t.PUSH_PSBT="PUSH_PSBT",t.GET_INSCRIPTIONS="GET_INSCRIPTIONS",t.SEND_INSCRIPTION="SEND_INSCRIPTION"})(r.MessageAction||(r.MessageAction={}))})(a||(a={}));const m={matches:["*://*/*"],async main(){console.log("Hello content script!"),await u("/injected.js");const r=chrome.runtime.connect({name:a.Port.CONTENT_BG}),t=new BroadcastChannel(a.Channel.INJECT_CONTENT),n=async e=>{console.log("Content 发送 BACKGROUND 消息:",e),await r.postMessage(e)};window.addEventListener("message",async e=>{const s=e.data,{metadata:i={}}=s,{to:l,from:S}=i;e.source===window&&S===a.MessageTo.INJECTED&&(console.log("Content 收到 INJECTED 消息:",e.data),s.metadata.from=a.MessageFrom.CONTENT,l===a.MessageTo.BACKGROUND&&await n(s))}),r.onMessage.addListener(async e=>{console.log("Content 收到 BACKGROUND 消息:",e);const{metadata:s={}}=e,{to:i,from:l}=s;l===a.MessageFrom.BACKGROUND&&(console.log("Content 收到 BACKGROUND 消息:",e),i===a.MessageTo.INJECTED&&t.postMessage(e))})}};function d(r,...t){}const I={debug:(...r)=>d(console.debug,...r),log:(...r)=>d(console.log,...r),warn:(...r)=>d(console.warn,...r),error:(...r)=>d(console.error,...r)},N=class N extends Event{constructor(t,n){super(N.EVENT_NAME,{}),this.newUrl=t,this.oldUrl=n}};c(N,"EVENT_NAME",p("wxt:locationchange"));let _=N;function p(r){var t;return`${(t=o==null?void 0:o.runtime)==null?void 0:t.id}:content:${r}`}function y(r){let t,n;return{run(){t==null&&(n=new URL(location.href),t=r.setInterval(()=>{let e=new URL(location.href);e.href!==n.href&&(window.dispatchEvent(new _(e,n)),n=e)},1e3))}}}const T=class T{constructor(t,n){c(this,"isTopFrame",window.self===window.top);c(this,"abortController");c(this,"locationWatcher",y(this));c(this,"receivedMessageIds",new Set);this.contentScriptName=t,this.options=n,this.abortController=new AbortController,this.isTopFrame?(this.listenForNewerScripts({ignoreFirstEvent:!0}),this.stopOldScripts()):this.listenForNewerScripts()}get signal(){return this.abortController.signal}abort(t){return this.abortController.abort(t)}get isInvalid(){return o.runtime.id==null&&this.notifyInvalidated(),this.signal.aborted}get isValid(){return!this.isInvalid}onInvalidated(t){return this.signal.addEventListener("abort",t),()=>this.signal.removeEventListener("abort",t)}block(){return new Promise(()=>{})}setInterval(t,n){const e=setInterval(()=>{this.isValid&&t()},n);return this.onInvalidated(()=>clearInterval(e)),e}setTimeout(t,n){const e=setTimeout(()=>{this.isValid&&t()},n);return this.onInvalidated(()=>clearTimeout(e)),e}requestAnimationFrame(t){const n=requestAnimationFrame((...e)=>{this.isValid&&t(...e)});return this.onInvalidated(()=>cancelAnimationFrame(n)),n}requestIdleCallback(t,n){const e=requestIdleCallback((...s)=>{this.signal.aborted||t(...s)},n);return this.onInvalidated(()=>cancelIdleCallback(e)),e}addEventListener(t,n,e,s){var i;n==="wxt:locationchange"&&this.isValid&&this.locationWatcher.run(),(i=t.addEventListener)==null||i.call(t,n.startsWith("wxt:")?p(n):n,e,{...s,signal:this.signal})}notifyInvalidated(){this.abort("Content script context invalidated"),I.debug(`Content script "${this.contentScriptName}" context invalidated`)}stopOldScripts(){window.postMessage({type:T.SCRIPT_STARTED_MESSAGE_TYPE,contentScriptName:this.contentScriptName,messageId:Math.random().toString(36).slice(2)},"*")}verifyScriptStartedEvent(t){var i,l,S;const n=((i=t.data)==null?void 0:i.type)===T.SCRIPT_STARTED_MESSAGE_TYPE,e=((l=t.data)==null?void 0:l.contentScriptName)===this.contentScriptName,s=!this.receivedMessageIds.has((S=t.data)==null?void 0:S.messageId);return n&&e&&s}listenForNewerScripts(t){let n=!0;const e=s=>{if(this.verifyScriptStartedEvent(s)){this.receivedMessageIds.add(s.data.messageId);const i=n;if(n=!1,i&&(t!=null&&t.ignoreFirstEvent))return;this.notifyInvalidated()}};addEventListener("message",e),this.onInvalidated(()=>removeEventListener("message",e))}};c(T,"SCRIPT_STARTED_MESSAGE_TYPE",p("wxt:content-script-started"));let P=T;const O=Symbol("null");let b=0;class w extends Map{constructor(){super(),this._objectHashes=new WeakMap,this._symbolHashes=new Map,this._publicKeys=new Map;const[t]=arguments;if(t!=null){if(typeof t[Symbol.iterator]!="function")throw new TypeError(typeof t+" is not iterable (cannot read property Symbol(Symbol.iterator))");for(const[n,e]of t)this.set(n,e)}}_getPublicKeys(t,n=!1){if(!Array.isArray(t))throw new TypeError("The keys parameter must be an array");const e=this._getPrivateKey(t,n);let s;return e&&this._publicKeys.has(e)?s=this._publicKeys.get(e):n&&(s=[...t],this._publicKeys.set(e,s)),{privateKey:e,publicKey:s}}_getPrivateKey(t,n=!1){const e=[];for(let s of t){s===null&&(s=O);const i=typeof s=="object"||typeof s=="function"?"_objectHashes":typeof s=="symbol"?"_symbolHashes":!1;if(!i)e.push(s);else if(this[i].has(s))e.push(this[i].get(s));else if(n){const l=`@@mkm-ref-${b++}@@`;this[i].set(s,l),e.push(l)}else return!1}return JSON.stringify(e)}set(t,n){const{publicKey:e}=this._getPublicKeys(t,!0);return super.set(e,n)}get(t){const{publicKey:n}=this._getPublicKeys(t);return super.get(n)}has(t){const{publicKey:n}=this._getPublicKeys(t);return super.has(n)}delete(t){const{publicKey:n,privateKey:e}=this._getPublicKeys(t);return!!(n&&super.delete(n)&&this._publicKeys.delete(e))}clear(){super.clear(),this._symbolHashes.clear(),this._publicKeys.clear()}get[Symbol.toStringTag](){return"ManyKeysMap"}get size(){return super.size}}new w;function G(){}function h(r,...t){}const g={debug:(...r)=>h(console.debug,...r),log:(...r)=>h(console.log,...r),warn:(...r)=>h(console.warn,...r),error:(...r)=>h(console.error,...r)};return(async()=>{try{const{main:r,...t}=m,n=new P("content",t);return await r(n)}catch(r){throw g.error('The content script "content" crashed on startup!',r),r}})()}();
content;
